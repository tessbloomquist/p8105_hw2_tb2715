---
title: "p8105_hw2_tb2715"
author: "Tess"
date: "9/24/2019"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Load libraries
```{r}
library(tidyverse)
library(readxl)
library(dplyr)
```

###Problem 1

#Load and clean trash wheel 2019 data
```{r}
trash_wheel_2019 = read_excel(path = "./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx", 
                         sheet = "Mr. Trash Wheel",
                         skip = 1)

tidy_trash_wheel =
  janitor::clean_names(trash_wheel_2019) %>%
  drop_na(dumpster) %>%
  select(-x15, -x16, -x17) %>%
  mutate(sports_balls = as.integer(sports_balls)) 

tidy_trash_wheel_17 = 
  filter(tidy_trash_wheel, year == '2017')

```

#Read in precipitation data
```{r}
precipitation_18 = read_excel(path = "./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx", 
  sheet = "2018 Precipitation", 
  skip = 1,
  col_names = TRUE) %>%
  drop_na(Month, Total) %>%
  mutate(Year = "2018")


precipitation_17 = read_excel(path = "./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx", 
  sheet = "2017 Precipitation", 
  skip = 1,
  col_names = TRUE) %>%
  drop_na(Month, Total) %>%
  mutate(Year = "2017")
```

#Merge precipitation data
```{r}
precipitation_data_test = 
  bind_rows(precipitation_18, precipitation_17) %>%
  mutate(Month = month.name[Month])
```

After cleaning the trashwheel data set, the tidy trashwheel data contains `r nrow(tidy_trash_wheel)` rows and `r ncol(tidy_trash_wheel)` columns. The columns consist of information collected from the site. Notably, some of these variables are :

`date` = date of trash collection
`dumpster` = specific dumpster
`sports_balls` = the number of sports balls collected in Mr. Trashwheel on the given date rounded to the nearest integer. The median number of sports balls in the dumpster in 2017 is `r median(pull(filter(tidy_trash_wheel, year ==2017), sports_balls))`.
`weight_tons` = the weight of trash in tons collected by Mr. Trashwheel on the given date 

After combining and cleaning the precipitation data set, it contains `r nrow(precipitation_data_test)` rows and `r ncol(precipitation_data_test)` columns.The columns are specific for:

`Month`= month of precipitation measurement
`Total` = total precipitation for a given month in specified year
`Year` = year of precipitation measurement

The total precipitation measured in 2018 is `r sum(pull(precipitation_18, Total))`
`

###Problem 2

#upload and clean pols_data
```{r}
pols_data = read_csv(file = "./data/fivethirtyeight_datasets/pols-month.csv") %>%
  janitor::clean_names() %>% 
  separate(col = mon, into = c("year", "month", "day")) %>%
  mutate(
    year = as.integer(year), 
    month = as.integer(month), 
    day = as.integer(day),
    month = month.name[month]) %>%
    mutate(president = recode(prez_dem, `1` = "dem", `0` = "gop")) %>%
  select(-prez_gop, -prez_dem, -day)
```

#upload and clean snp_data
```{r}
snp_data = read_csv(file = "./data/fivethirtyeight_datasets/snp.csv") %>%
  janitor::clean_names() %>% 
  separate(col = date, into = c("month", "day", "year")) %>%
  mutate(
    year = as.integer(year), 
    month = as.integer(month), 
    day = as.integer(day),
    month = month.name[month]) %>%
  select(year, month, close)
```


#upload and clean unemployment_data
```{r}
unemployment_data = read_csv(file = "./data/fivethirtyeight_datasets/unemployment.csv") %>%
  janitor::clean_names() 

tidy_unemployment_data =
    pivot_longer(
    unemployment_data, 
    jan:dec, 
    names_to = "month", 
    values_to = "unemployed") %>%
  mutate(
    month = recode(month, "jan" = "January", 
                   "feb" = "February", 
                   "mar" = "March", 
                   "apr" = "April", 
                   "may" = "May", 
                   "jun" = "June", 
                   "jul" = "July", 
                   "aug" = "August", 
                   "sep" = "September", 
                   "oct" = "October", 
                   "nov" = "November", 
                   "dec" = "December")) 
```

#merge data sets
```{r}
snp_pols_merge = 
  left_join(pols_data, snp_data, by = c("year","month"))

merge_385 = 
  left_join(snp_pols_merge, tidy_unemployment_data, by = c("year","month"))
```

The data set “pols-data” contains `r nrow(pols_data)` observations of `r ncol(pols_data)` variables related to the number of national politicians who are democratic or republican at any given time. The “snp” data contains `r nrow(snp_data)` observations of `r ncol(snp_data)` variables related to Standard & Poor’s stock market index (S&P), often used as a representative measure of stock market as a whole. The “unemployment” dataset contains `r nrow(tidy_unemployment_data)` observations of `r ncol(tidy_unemployment_data)` variables outlining the percentage of unemployment in a given month and year.

The merge 385 data set, containing all of the above data merged based on date allows us to compare presidental party power with social/economic outcomes such as unemployment and stocks. The merged data contains `r nrow(merge_385)` observations of `r ncol(merge_385)`

month: date of the count
gov_gop: the number of republican governors on the associated date
sen_gop: the number of republican senators on the associated date
rep_gop: the number of republican representatives on the associated date
gov_dem: the number of democratic governors on the associated date
sen_dem: the number of democratic senators on the associated date
rep_dem: the number of democratic representatives on the associated date
president: indicator of whether the president was a republican or democrat 
close: the closing values of the S&P stock index on the associated date
unemployed: percentage of unemployment in January of the associated year

###Problem 3

#upload data and clean to demonstrate name rank in a certain year
```{r}
baby_name = read_csv(file = "./data/Popular_Baby_Names.csv") %>%
  janitor::clean_names() %>%
  distinct(childs_first_name, ethnicity, year_of_birth, count, rank, gender) 
```

#filter data to only observe babies named Olivia and rank over time
```{r}
olivia_baby =
  filter(baby_name, childs_first_name == "Olivia") %>%
    select(-count) %>%
    pivot_wider(
    names_from = "year_of_birth", 
    values_from = "rank") 
```

#filter data to observe male children name rank over time
```{r}
male_baby = 
  filter(baby_name, gender == "MALE", rank == "1") %>%
  select(-count, -rank, -gender) %>%
    pivot_wider(
    names_from = "year_of_birth", 
    values_from = "childs_first_name") 
##Need to make sure ethnicities appear in the same way
```

#create a new data frame to observe a certain population of males to use in scatterplot below
```{r}
male_plot_df = 
  filter(baby_name, 
         gender == "MALE", 
         ethnicity == "WHITE NON HISPANIC", 
         year_of_birth == "2016")
  
male_plot = 
  ggplot(male_plot_df, aes(x = rank, y = count)) +
  geom_point()

male_plot
```

#unused code
 aggregate(olivia_baby[c("2016", "2015", "2014", "2013", "2012", "2011")], by = list(olivia_baby$childs_first_name, olivia_baby$ethnicity, olivia_baby$gender), FUN = "mean", na.rm = T)
 ##Read in dataset

#cpi_data = read_csv(file = "./data/fivethirtyeight_datasets/cpi.csv")

#gdp_data = read_csv(file = "./data/fivethirtyeight_datasets/GDP.csv")

#recession_data = read_csv(file = "./data/fivethirtyeight_datasets/recessions.csv")

#UPDATE WITH NEW DATASET INCLUDE 2019
trash_wheel = read_excel(path = "./data/HealthyHarborWaterWheelTotals2018-7-28.xlsx", 
                         sheet = "Mr. Trash Wheel",
                         col_names = TRUE)
                         
                         #precipitation_data = 
  #merge(precipitation_18, precipitation_17, by = "Month") %>%
  
#HOW TO USE MONTH.NAME

#OR
  mutate(
    month = recode(month, "01" = "January", 
                   "02" = "February", 
                   "03" = "March", 
                   "04" = "April", 
                   "05" = "May", 
                   "06" = "June", 
                   "07" = "July", 
                   "08" = "August", 
                   "09" = "September", 
                   "10" = "October", 
                   "11" = "November", 
                   "12" = "December")) %>%
                   
                     select(pols_data, -prez_gop, -prez_dem, -day)
                     
tidy_baby_name = 
  pivot_wider(
    tidy_baby_name,
    names_from = "year_of_birth", 
    values_from = "rank") 
